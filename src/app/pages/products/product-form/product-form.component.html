<div class="product-form-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>{{ isEditMode ? 'Modifier le produit' : 'Nouveau produit' }}</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Nom du produit</mat-label>
            <input matInput formControlName="name" placeholder="Entrez le nom du produit">
            <mat-error *ngIf="f['name'].invalid && f['name'].touched">
              Le nom est requis et ne doit pas dépasser 100 caractères
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>SKU</mat-label>
            <input matInput formControlName="sku" placeholder="Entrez le SKU">
            <mat-error *ngIf="f['sku'].invalid && f['sku'].touched">
              Le SKU est requis et ne doit pas dépasser 50 caractères
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Description</mat-label>
            <textarea matInput formControlName="description" placeholder="Entrez la description" rows="3"></textarea>
            <mat-error *ngIf="f['description'].invalid && f['description'].touched">
              La description est requise et ne doit pas dépasser 500 caractères
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Prix (€)</mat-label>
            <input matInput type="number" formControlName="price" placeholder="0.00" step="0.01" min="0">
            <mat-error *ngIf="f['price'].invalid && f['price'].touched">
              Le prix doit être supérieur à 0
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Quantité en stock</mat-label>
            <input matInput type="number" formControlName="stockQuantity" placeholder="0" min="0">
            <mat-error *ngIf="f['stockQuantity'].invalid && f['stockQuantity'].touched">
              La quantité doit être un nombre positif
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Catégorie</mat-label>
            <input matInput formControlName="category" placeholder="Entrez la catégorie">
            <mat-error *ngIf="f['category'].invalid && f['category'].touched">
              La catégorie est requise et ne doit pas dépasser 50 caractères
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Seuil d'alerte stock</mat-label>
            <input matInput type="number" formControlName="lowStockThreshold" placeholder="0" min="0">
            <mat-hint>Quantité minimale avant alerte de stock faible</mat-hint>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Statut</mat-label>
            <mat-select formControlName="status">
              <mat-option *ngFor="let status of statusOptions" [value]="status.value">
                {{ status.viewValue }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="f['status'].invalid && f['status'].touched">
              Le statut est requis
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>URL de l'image</mat-label>
            <input matInput formControlName="imageUrl" placeholder="https://exemple.com/image.jpg">
            <mat-error *ngIf="f['imageUrl'].invalid && f['imageUrl'].touched">
              L'URL doit être valide (commencer par http:// ou https://)
            </mat-error>
          </mat-form-field>
        </div>

        <div *ngIf="error" class="error-message">
          <mat-icon color="warn">error</mat-icon>
          {{ error }}
        </div>
      </form>
    </mat-card-content>

    <mat-card-actions align="end">
      <button mat-button type="button" (click)="onCancel()">Annuler</button>
      <button mat-raised-button color="primary" type="submit" (click)="onSubmit()"
              [disabled]="productForm.invalid || isLoading">
        <mat-icon *ngIf="isLoading">hourglass_empty</mat-icon>
        {{ isLoading ? (isEditMode ? 'Mise à jour...' : 'Création...') : (isEditMode ? 'Mettre à jour' : 'Créer') }}
      </button>
    </mat-card-actions>
  </mat-card>
</div>